CMAKE_MINIMUM_REQUIRED(VERSION 3.0.0)
PROJECT(Trinity.C)

INCLUDE_DIRECTORIES(src)
INCLUDE_DIRECTORIES(include)

FILE(GLOB SRC src/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} include/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/BackgroundThread/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Debugger/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Mathematics/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Memory/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Runtime/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Storage/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Threading/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Trinity/*.cpp)
FILE(GLOB_RECURSE SRC ${SRC} src/Utility/*.cpp)
FILE(GLOB SRC ${SRC} src/Network/*.cpp)
FILE(GLOB SRC ${SRC} src/Network/Client/*.cpp)
FILE(GLOB SRC ${SRC} src/Network/Server/*.cpp)

ADD_LIBRARY(Trinity SHARED "")
TARGET_INCLUDE_DIRECTORIES(Trinity PUBLIC include src)
 
IF(UNIX) 

    FILE(GLOB_RECURSE UNIX_SRC src/Network/*/posix/*.cpp)
    TARGET_SOURCES(Trinity PRIVATE ${SRC} ${UNIX_SRC})

    ADD_DEFINITIONS(-DTRINITYC_EXPORTS -DUNICODE -D_UNICODE)
    TARGET_LINK_LIBRARIES(Trinity PRIVATE crypto;ssl)

ELSEIF(WIN32)

    FILE(GLOB_RECURSE WIN_SRC src/Network/*/iocp/*.cpp)
    FILE(GLOB_RECURSE WIN_SRC ${WIN_SRC} src/Network/*/windows/*.cpp)
    TARGET_SOURCES(Trinity PRIVATE ${SRC} ${WIN_SRC})

    ADD_DEFINITIONS(-DTRINITYC_EXPORTS -D_CRT_SECURE_NO_WARNINGS -DUNICODE -D_UNICODE)
    ADD_DEFINITIONS(-DWIN32 -DNDEBUG -D_WINDOWS -D_USRDLL -D_WINSOCK_DEPRECATED_NO_WARNINGS -D_SCL_SECURE_NO_WARNINGS)

    TARGET_COMPILE_OPTIONS(Trinity     PRIVATE "/Fd Trinity.pdb")
    TARGET_LINK_LIBRARIES(Trinity      PRIVATE Psapi.lib;ws2_32.lib;Dbghelp.lib;Synchronization.lib)

    POSTBUILD_COPY_OUTPUT(Trinity      "${PROJECT_BINARY_DIR}/Trinity.pdb")

    INSTALL(FILES   ${PROJECT_BINARY_DIR}/Trinity.pdb 
            ARCHIVE DESTINATION lib)

ENDIF()

POSTBUILD_XPLAT_OUTPUT(Trinity)
